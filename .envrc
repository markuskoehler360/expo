PATH_add bin

if ! has chruby; then
  local chruby
  if has brew; then
    if [[ -e "$(brew --prefix)/opt/chruby/share/chruby/chruby.sh" ]]; then
      chruby="$(brew --prefix)/opt/chruby/share/chruby/chruby.sh"
    fi
  else
    chruby=/usr/local/share/chruby/chruby.sh
  fi
  [ -e "${chruby}" ] && source "${chruby}"
fi

if has chruby; then
  chruby 2.6.3
fi

layout ruby

export EXPO_ROOT_DIR=`pwd`
export ANDROID_HOME=$ANDROID_SDK
export NIX_PATH=expo=`pwd`/nix:$NIX_PATH

source_local() {
  file=./.envrc.local
  if [[ -f "$file" ]]; then
    source_env "$file"
  fi
  watch_file "$file"
}

source_secrets() {
  file=$1
  if [[ -f "$file" ]] && head -1 "$file" | grep --quiet "#!"; then
    source_env "$file"
  fi
  watch_file "$file"
}

source_secrets secrets/expotools.env
source_local
